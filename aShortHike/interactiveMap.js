var editing=!1;function getItems(){let e={};for(let t=0;t<$(".barIcon img").length;t++){let s=$(".barIcon img").eq(t).attr("src");e[s.substring(9,s.length-4)]={name:$(".barTip span").eq(t).text(),list:[]}}for(let t=0;t<$(".item").length;t++){let s=$(".item").eq(t),a=s[0].classList[1];if(!Object.keys(e).includes(a)){console.log("unknown item type");continue}let l=s.css("left"),i=s.css("bottom"),n=parseInt($(s).children(".number").html()),o=$(s).children(".tooltip").html(),c=s.find("img").attr("src");c=c.substring(c.lastIndexOf("_")+1,c.lastIndexOf(".")),-1!=o.indexOf("(")&&(o=o.replace(/ \(\d+\)/g,"")),e[a].list.push({x:parseFloat(l),y:parseFloat(i),desc:o,...n>1&&{nb:n},...a!=c&&{ico:c}})}let t=JSON.stringify(e),s=[t.slice(0,1),"\n",t.slice(1)].join("").replace(/":{/g,'":\n\t{').replace(/":\[/g,'":[\n\t\t').replace(/},{/g,"},\n\t\t{").replace(/]},/g,"\n\t]},\n").replace(/]}}/g,"\n\t]}\n}");console.log(s)}function getPath(){let e={};for(let t=0;t<$("path").length;t++){let s=$("path").eq(t).attr("id");e[s.substring(4)]={name:$("path").eq(t).attr("name"),list:[]};let a=0;for(;$("#"+s+a).length>0;){let t={},l=parseFloat($("#"+s+a).css("cx")),i=parseFloat($("#"+s+a).css("cy"));t.point={x:l,y:i};let n=parseFloat($("#"+s+a+"_1").css("cx"));if(!isNaN(n)){let e=parseFloat($("#"+s+a+"_1").css("cy"));t.handleL={x:n,y:e}}let o=parseFloat($("#"+s+a+"_2").css("cx"));if(!isNaN(o)){let e=parseFloat($("#"+s+a+"_2").css("cy"));t.handleR={x:o,y:e}}e[s.substring(4)].list[a++]=t}}let t=JSON.stringify(e),s=[t.slice(0,1),"\n",t.slice(1)].join("").replace(/":{"n/g,'":\n\t{"n').replace(/":\[/g,'":[\n\t\t').replace(/},{/g,"},\n\t\t{").replace(/]},/g,"\n\t]},\n").replace(/]}}/g,"\n\t]}\n}");console.log(s)}function getFishRegion(){let e={square:[]};for(let t=0;t<$("svg rect.fish").length;t++){let s=$("svg rect.fish").eq(t),a=parseFloat(s.css("x")),l=parseFloat(s.css("y")),i=2*parseFloat(s.css("width")),n=2*parseFloat(s.css("height"));e.square[t]={x:a,y:l,width:i,height:n,desc:""}}e.circle=[];for(let t=0;t<$("svg circle.fish").length;t++){let s=$("svg circle.fish").eq(t),a=parseFloat(s.css("cx")),l=parseFloat(s.css("cy")),i=parseFloat(s.css("r"));e.circle[t]={x:a,y:l,radius:i,desc:""}}let t=JSON.stringify(e),s=[t.slice(0,1),"\n",t.slice(1)].join("").replace(/":\[/g,'":[\n\t').replace(/},{/g,"},\n\t{").replace(/}\]/g,"}\n]").replace(/],/g,"],\n");console.log(s)}var clickX,clickY,wheelX,wheelY,wheelEvent="";const stepZoom=20;var mapZoom=mapLerp=20,lerpRatio=.2,dragElem=null,dragSvg=null,hovItem=null,zIndex=3;function zoomMap(){if(mapLerp!=mapZoom){let e=1e-4,t=0;if(Math.abs(mapZoom-mapLerp)<e)mapLerp=mapZoom;else{let e=lerp(mapLerp,mapZoom,lerpRatio);t=1-zoomFunc(e)/zoomFunc(mapLerp),mapLerp=e}let s=$("#map").css("transform"),a=s.lastIndexOf(","),l=s.lastIndexOf(",",a-1),i=parseFloat(s.substring(a+2,s.length-1)),n=parseFloat(s.substring(l+2,a)),o=$("#mapContainer")[0],c=i+(wheelY-o.offsetTop-i)*t,r=n+(wheelX-o.offsetLeft-n)*t,p=zoomFunc(mapLerp);$("#map").css("transform","matrix("+p+", 0, 0, "+p+", "+r+", "+c+")"),$("#pathTooltip").css("transform","scale("+1/p+")"),$(".item").css("transform","scale("+1/p+")"),setSliderHeight(mapZoom)}requestAnimationFrame(zoomMap)}function lerp(e,t,s){return e*(1-s)+t*s}function zoomFunc(e){return 1/e*2}function showClass(e,t){t?$(e).removeClass("iconHide"):$(e).addClass("iconHide");let s=$(e).attr("src"),a=s.substring(s.indexOf("_")+1,s.length-4);t?$("."+a).removeClass("itemHidden"):$("."+a).addClass("itemHidden")}$(document).ready(function(){let e=document.querySelector("#lowResMap");e.decode().then(()=>{let t=document.querySelector("#highResMap");t.decode().then(()=>{t.style.visibility="visible",e.parentNode.removeChild(e)})});var t=$("<div>").prependTo($("#bar")).addClass("barTip"),s=$("<div>").prependTo($("#bar")).addClass("barIcon");for(let e=Object.keys(items).length-1;e>=0;e--){let a=Object.keys(items)[e],l=Object.values(items)[e].name;s.prepend("<div><img draggable='false' ondragstart='return false;' src='res/icon_"+a+".png'/></div>"),t.prepend("<div><div><span>"+l+"</span></div></div>");for(let t=0;t<Object.values(items)[e].list.length;t++){let s=Object.values(items)[e].list[t],l=$("<div style= 'left: "+s.x+"px; bottom: "+s.y+"px' class='item "+a+"'><img draggable='false' ondragstart='return false;' src='res/icon_"+(s.hasOwnProperty("ico")?s.ico:a)+".png'/></div>"),i=$('<span class="tooltip">'+s.desc+"</span>")[0];s.nb>1&&(l.append("<span class='number'>"+s.nb+"</span>"),i.innerHTML=i.innerHTML.replace(/<br>/g," ("+s.nb+")<br>")),l.append(i),$("#map").append(l);let n=i.clientWidth;i.style.width=n+"px",i.style.marginLeft=-(n/2+10)+"px"}}$("#map").prepend('<div id="pathTooltip"></div>');let a='<svg class="svgData" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" draggable="false" ondragstart="return false">';for(let e=Object.keys(paths).length-1;e>=0;e--){let t="path"+Object.keys(paths)[e],s=Object.values(paths)[e].name,l=Object.values(paths)[e].list[0],i=l.point,n='<path id="'+t+'" name="'+s+'" d="M '+(i.x+(null!=l.handleR?0:16))+" "+(i.y+(null!=l.handleR?0:16)),o='<circle class="path point" id="'+t+'0" cx="'+(l.point.x+(null!=l.handleR?0:16))+'" cy="'+(l.point.y+(null!=l.handleR?0:16))+'" r="7.5"/>';editing&&(o+='<circle class="path handle" id="'+t+'0_2" cx="'+(null!=l.handleR?l.handleR.x:l.point.x+32)+'" cy="'+(null!=l.handleR?l.handleR.y:l.point.y+32)+'" r="5"/>');for(let s=1;s<Object.values(paths)[e].list.length;s++){let a=Object.values(paths)[e].list[s],l=Object.values(paths)[e].list[s-1],i=null!=a.handleL||null!=a.handleR;n+=i?", C "+l.handleR.x+" "+l.handleR.y+" "+a.handleL.x+" "+a.handleL.y+" "+a.point.x+" "+a.point.y:", "+(a.point.x+16)+" "+(a.point.y+16),o+='<circle class="path point" id="'+t+s+'" cx="'+(a.point.x+(i?0:16))+'" cy="'+(a.point.y+(i?0:16))+'" r="7.5"/>',editing&&(o+='<circle class="path handle" id="'+t+s+'_1" cx="'+(i?a.handleL.x:a.point.x)+'" cy="'+(i?a.handleL.y:a.point.y)+'" r="5"/>',s!=Object.values(paths)[e].list.length-1&&(o+='<circle class="path handle" id="'+t+s+'_2" cx="'+(i?a.handleR.x:a.point.x+32)+'" cy="'+(i?a.handleR.y:a.point.y+32)+'" r="5"/>'))}a+=(n+='"></path>')+o}for(let e=Object.keys(fishRegions.square).length-1;e>=0;e--){let t=fishRegions.square[e];a+='<rect class="fish" x="'+t.x+'" y="'+t.y+'" width="'+t.width+'" height="'+t.height+'" desc="'+t.desc+'"/>'}for(let e=Object.keys(fishRegions.circle).length-1;e>=0;e--){let t=fishRegions.circle[e];a+='<circle class="fish" cx="'+t.x+'" cy="'+t.y+'" r="'+t.radius+'" desc="'+t.desc+'"/>'}$("#map").prepend(a+"</svg>"),$(".barIcon div:nth-last-child(-n+3)").each(function(){showClass(this.firstChild)}),$(".barIcon > div").hover(function(){$(".barTip").children().eq($(this).index()).css("opacity",1).css("visibility","visible")},function(){$(".barTip").children().eq($(this).index()).css("opacity",0).css("visibility","hidden")}),$(".barIcon > div").click(function(e){e.ctrlKey?($.each($(".barIcon img"),function(){showClass(this,!1)}),showClass($(this).find("img"),!0)):e.altKey?$.each($(".barIcon img"),function(){showClass(this,$(this).hasClass("iconHide"))}):e.shiftKey?$.each($(".barIcon img"),function(){showClass(this,!0)}):showClass($(this).find("img"),$(this).find("img").hasClass("iconHide"))}),$("#compass").click(function(){mapZoom=mapLerp=20,$("#map").css("transform","translate(0px, 0px) scale("+zoomFunc(20)+")"),$(".item").css("transform",""),setSliderHeight(20)}),$(".item").hover(function(){$(this).css("z-index",++zIndex),hovItem=$(this)},function(){hovItem=null}),wheelEvent=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel",$("svg .point").hover(function(){let e=$(this).prev();for(;"path"!=e.prop("nodeName");)e=e.prev();$("#pathTooltip").text(e.attr("name")).css("width","auto");let t=$("#pathTooltip")[0].clientWidth;$("#pathTooltip").css("left",this.getAttribute("cx")+"px").css("bottom",this.getAttribute("cy")+"px").css("margin-left",-(t/2+10)+"px").css("width",t+"px").css("visibility","visible").css("opacity",1)},function(){$("#pathTooltip").css("opacity",0).css("visibility","hidden")}),$("svg .fish").hover(function(){let e=fishTexts[$(this).attr("desc")];$("#pathTooltip").html(e).css("width","auto");let t,s,a=$("#pathTooltip")[0].clientWidth;"rect"==this.nodeName?(t=parseFloat(this.getAttribute("x"))+parseFloat(this.getAttribute("width"))/2,s=parseFloat(this.getAttribute("y"))+parseFloat(this.getAttribute("height"))):(t=parseFloat(this.getAttribute("cx")),s=parseFloat(this.getAttribute("cy"))+parseFloat(this.getAttribute("r"))),$("#pathTooltip").css("left",t+"px").css("bottom",s+"px").css("margin-left",-(a/2+10)+"px").css("width",a+"px").css("visibility","visible").css("opacity",1)},function(){$("#pathTooltip").css("opacity",0).css("visibility","hidden")})}),$(document).on({mousemove:function(e){let t;if(editing&&dragElem&&void 0!==(t=dragElem.attr("class"))&&t.includes("item")){let t=dragElem.css("transform"),s=parseFloat(t.substring(7,t.indexOf(","))),a=parseFloat(dragElem.css("left"))-(clickX-e.pageX)*s,l=parseFloat(dragElem.css("bottom"))+(clickY-e.pageY)*s;dragElem.css("left",a+"px").css("bottom",l+"px")}else if(editing&&dragSvg&&void 0!==(t=dragSvg.attr("class"))&&t.includes("path")){let t=$(".item").eq(0).css("transform"),s=parseFloat(t.substring(7,t.indexOf(","))),a=parseFloat(dragSvg.css("cx"))-(clickX-e.pageX)*s,l=parseFloat(dragSvg.css("cy"))+(clickY-e.pageY)*s;dragSvg.css("cx",a+"px").css("cy",l+"px");for(let e=Object.keys(paths).length-1;e>=0;e--){let t="path"+Object.keys(paths)[e],s="M "+parseFloat($("#"+t+"0").css("cx"))+" "+parseFloat($("#"+t+"0").css("cy"))+", ";for(let a=1;a<Object.values(paths)[e].list.length;a++)s+="C "+parseFloat($("#"+t+(a-1)+"_2").css("cx"))+" "+parseFloat($("#"+t+(a-1)+"_2").css("cy"))+" "+parseFloat($("#"+t+a+"_1").css("cx"))+" "+parseFloat($("#"+t+a+"_1").css("cy"))+" "+parseFloat($("#"+t+a).css("cx"))+" "+parseFloat($("#"+t+a).css("cy"))+", ";$("#"+t).attr("d",s)}}else if(editing&&dragSvg&&void 0!==(t=dragSvg.attr("class"))&&t.includes("fish")){let t=$(".item").eq(0).css("transform"),s=parseFloat(t.substring(7,t.indexOf(",")));if("rect"==dragSvg[0].nodeName){let t=parseFloat(dragSvg.css("x"))-(clickX-e.pageX)*s,a=parseFloat(dragSvg.css("y"))+(clickY-e.pageY)*s;dragSvg.css("x",t+"px").css("y",a+"px")}else{let t=parseFloat(dragSvg.css("cx"))-(clickX-e.pageX)*s,a=parseFloat(dragSvg.css("cy"))+(clickY-e.pageY)*s;dragSvg.css("cx",t+"px").css("cy",a+"px")}}else if(dragElem&&("map"==dragElem[0].id||"#document"==dragElem[0].nodeName||"svg"==dragElem[0].nodeName||void 0!==(t=dragElem.attr("class"))&&t.includes("item"))){let t=$("#map").css("transform").split(","),s=parseFloat(t[3]),a=parseFloat(t[4])-(clickX-e.pageX),l=parseFloat(t[5])-(clickY-e.pageY);$("#map").css("transform","translate("+a+"px, "+l+"px) scale("+s+")")}clickX=e.pageX,clickY=e.pageY},mousedown:function(e){dragSvg=$(e.target),dragElem=$(e.target).parent(),e.ctrlKey&&dragElem&&void 0!==(className=dragElem.attr("class"))&&className.includes("item")&&dragElem.clone(!0).appendTo(dragElem.parent()),clickX=e.pageX,clickY=e.pageY},mouseup:function(){dragElem=null,dragSvg=null},mousewheel:function(e){wheelX=e.pageX,wheelY=e.pageY;let t=mapZoom<2||2==mapZoom&&e.originalEvent.wheelDelta>0?.5:1;mapZoom=Math.min(Math.max(mapZoom+(e.originalEvent.wheelDelta>0?-t:t),1),20)},DOMMouseScroll:function(e){wheelX=e.pageX,wheelY=e.pageY;let t=mapZoom<2||2==mapZoom&&-e.originalEvent.detail>0?.5:1;mapZoom=Math.min(Math.max(mapZoom+(-e.originalEvent.detail>0?-t:t),1),20)},keydown:function(e){if(null!=hovItem&&editing)if(107==e.which||109==e.which){let t=hovItem.children(".number");0==t.length&&107==e.which&&(t=$("<span class='number'>1</span>").appendTo(hovItem)),107==e.which&&t.html(parseInt(t.html())+1),109==e.which&&t.html(parseInt(t.html())-1),"1"==t.html()&&t.remove()}else{let t=hovItem.children(".tooltip");switch(e.which){case 8:t.html(t.html().substring(0,t.html().length-1));break;case 13:t.append("<br>")}1==e.key.length&&hovItem.children(".tooltip").html(hovItem.children(".tooltip").html()+e.key)}}}),$(".menu input").on("input",function(e){e.target.value.length>0?$.each($(".item .tooltip"),function(){-1==$(this).parent().text().toLowerCase().indexOf(e.target.value)?($(this).parent().removeClass("searchShown").addClass("searchHidden"),$(this).removeClass("searchShown").addClass("searchHidden")):($(this).parent().removeClass("searchHidden").addClass("searchShown"),$(this).removeClass("searchHidden").addClass("searchShown"))}):$.each($(".item .tooltip"),function(){$(this).parent().removeClass("searchShown").removeClass("searchHidden"),$(this).removeClass("searchShown").removeClass("searchHidden")})}),requestAnimationFrame(zoomMap);var setSliderHeight=function(e){slider.style.height=100/19*(mapZoom-1)+"%"},container=document.getElementById("slider-container"),slider=document.getElementById("slider-bar"),handle=document.getElementById("slider-handle"),isSliding=!1,move=function(e){var t,s=0,a=0;if(!e)e=window.event;e.pageY?s=e.pageY:e.clientY&&(s=e.clientY),(a=100*(s-container.offsetTop)/container.offsetHeight)<0?a=0:a>100&&(a=100),slider.style.height=a+"%",t=19*a/100,wheelX=$(window).width()/2,wheelY=$(window).height()/2,mapZoom=t+1},addSlide=function(){isSliding=!0,window.addEventListener?document.addEventListener("mousemove",move,!1):document.attachEvent("onmousemove",move)},cancelSlide=function(){isSliding&&(window.removeEventListener?document.removeEventListener("mousemove",move,!1):window.detachEvent&&document.detachEvent("onmousemove",move))},cancelBubble=function(e){var t=e||window.event;t.stopPropogation&&t.stopPropogation(),null!=t.cancelBubble&&(t.cancelBubble=!0),t.preventDefault?t.preventDefault():t.returnValue=!1},addSlideEvent=function(e){addSlide(),cancelBubble(e)},cancelSlideEvent=function(e){cancelSlide(),cancelBubble(e)},moveEvent=function(e){move(e),cancelBubble(e)};handle.onmousedown=addSlideEvent,handle.onmouseup=cancelSlideEvent,slider.onmousedown=moveEvent,slider.onmouseup=cancelSlideEvent,container.onmousedown=moveEvent,container.onmouseup=cancelSlideEvent,document.onmouseup=cancelSlideEvent,jQuery.expr[":"].icontains=function(e,t,s){return jQuery(e).text().toUpperCase().indexOf(s[3].toUpperCase())>=0};